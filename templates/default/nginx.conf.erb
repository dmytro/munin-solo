# This file was generated by Chef for <%= node['fqdn'] %>
# Do NOT modify this file by hand!

server {
  listen <%= node['munin']['web_server_port'] %>;
  <% if node['munin']['url'] %>
  server_name <%= node['munin']['url'] %>;
  <% else %>
  server_name munin <%= node['munin']['public_domain'] %> <%= node['fqdn'] %>;
  <% end %>
  access_log <%= File.join(node['nginx']['log_dir'], 'nginx_access.log') %>;
  error_log <%= File.join(node['nginx']['log_dir'], 'nginx_error.log') %>;

  auth_basic "Munin Server";
  auth_basic_user_file <%= @htpasswd_file %>;

  location /munin {
    root <%= node['munin']['docroot'] %>;
  }

  <% if @nginx_fastcgi_support %>
  location ^~ /cgi-bin/munin-cgi-graph/ {
    fastcgi_split_path_info ^(/cgi-bin/munin-cgi-graph)(.*);
    fastcgi_param PATH_INFO $fastcgi_path_info;
    fastcgi_pass unix:/var/run/munin/fastcgi-graph.sock;
    include fastcgi_params;
  }
  <% end %>

  location / {
    root <%= @docroot %>;
  }
}
